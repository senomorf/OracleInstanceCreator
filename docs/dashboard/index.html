<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src https://fonts.gstatic.com https://cdnjs.cloudflare.com; connect-src 'self' https://api.github.com;">
    <title>Oracle Instance Creator Dashboard</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-content">
                <div class="logo-section">
                    <i class="fab fa-github"></i>
                    <h1>Oracle Instance Creator</h1>
                    <span class="version">v2.0 Enhanced</span>
                </div>
                <div class="status-indicators">
                    <div class="status-item" id="connection-status">
                        <i class="fas fa-circle"></i>
                        <span>Connecting...</span>
                    </div>
                    <div class="status-item" id="last-update">
                        <i class="far fa-clock"></i>
                        <span>Never</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Dashboard -->
        <main class="dashboard-main">
            <!-- Security Warning -->
            <section id="security-warning" class="security-warning-banner">
                <div class="warning-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="warning-content">
                    <h4>CRITICAL SECURITY WARNING</h4>
                    <p>
                        Storing a GitHub Personal Access Token (PAT) in your browser is highly insecure and exposes you to significant risk. 
                        A compromised token could grant an attacker full access to your repositories. 
                        <strong>Use the dashboard in read-only mode.</strong> For write actions (triggering workflows), use a dedicated, least-privilege token and revoke it immediately after use.
                    </p>
                </div>
            </section>

            <!-- Quick Stats Row -->
            <section class="stats-grid">
                <div class="stat-card primary">
                    <div class="stat-icon">
                        <i class="fas fa-server"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="instance-status">Checking...</h3>
                        <p>Instance Status</p>
                        <div class="stat-trend" id="instance-trend"></div>
                    </div>
                </div>

                <div class="stat-card success">
                    <div class="stat-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="success-rate">---%</h3>
                        <p>Success Rate (30d)</p>
                        <div class="stat-trend" id="success-trend"></div>
                    </div>
                </div>

                <div class="stat-card warning">
                    <div class="stat-icon">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="usage-percentage">---%</h3>
                        <p>Free Tier Usage</p>
                        <div class="stat-trend" id="usage-trend"></div>
                    </div>
                </div>

                <div class="stat-card info">
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="next-run">--:--</h3>
                        <p>Next Scheduled Run</p>
                        <div class="stat-trend" id="schedule-context"></div>
                    </div>
                </div>
            </section>

            <!-- Charts Row -->
            <section class="charts-row">
                <div class="chart-container">
                    <div class="chart-header">
                        <h3><i class="fas fa-chart-area"></i> Success Pattern Analysis</h3>
                        <div class="chart-controls">
                            <select id="pattern-timeframe">
                                <option value="7">Last 7 days</option>
                                <option value="30" selected>Last 30 days</option>
                                <option value="90">Last 90 days</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-content">
                        <canvas id="success-pattern-chart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-header">
                        <h3><i class="fas fa-stopwatch"></i> Usage Tracking</h3>
                        <div class="chart-controls">
                            <select id="usage-view">
                                <option value="daily">Daily Usage</option>
                                <option value="monthly" selected>Monthly Trend</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-content">
                        <canvas id="usage-chart"></canvas>
                    </div>
                </div>
            </section>

            <!-- Data Tables Row -->
            <section class="data-row">
                <div class="data-container">
                    <div class="data-header">
                        <h3><i class="fas fa-history"></i> Recent Workflow Runs</h3>
                        <div class="data-controls">
                            <button id="refresh-runs" class="btn-icon">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div class="data-content">
                        <div class="runs-table" id="workflow-runs">
                            <div class="loading">Loading recent runs...</div>
                        </div>
                    </div>
                </div>

                <div class="data-container">
                    <div class="data-header">
                        <h3><i class="fas fa-map-marker-alt"></i> AD Performance</h3>
                        <div class="data-controls">
                            <span class="info-badge" id="ad-update-time">Updated: Never</span>
                        </div>
                    </div>
                    <div class="data-content">
                        <div class="ad-performance" id="ad-stats">
                            <div class="loading">Loading AD statistics...</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Regional Optimization Row -->
            <section class="optimization-row">
                <div class="optimization-container">
                    <div class="optimization-header">
                        <h3><i class="fas fa-globe-asia"></i> Regional Schedule Optimization</h3>
                        <div class="optimization-controls">
                            <select id="region-selector">
                                <option value="auto">Auto-detect Region</option>
                                <option value="ap-singapore-1">Asia Pacific (Singapore)</option>
                                <option value="ap-mumbai-1">Asia Pacific (Mumbai)</option>
                                <option value="us-east-1">US East (N. Virginia)</option>
                                <option value="us-west-2">US West (Oregon)</option>
                                <option value="eu-frankfurt-1">Europe (Frankfurt)</option>
                            </select>
                        </div>
                    </div>
                    <div class="optimization-content">
                        <div class="schedule-analysis" id="schedule-recommendations">
                            <div class="loading">Loading schedule analysis...</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Control Panel -->
            <section class="control-panel">
                <div class="panel-container">
                    <div class="panel-header">
                        <h3><i class="fas fa-cogs"></i> Workflow Controls</h3>
                        <div class="panel-status" id="workflow-status">
                            <span class="status-dot"></span>
                            <span>Ready</span>
                        </div>
                    </div>
                    <div class="panel-content">
                        <div class="control-grid">
                            <button id="trigger-workflow" class="control-btn primary">
                                <i class="fas fa-play"></i>
                                <span>Trigger Manual Run</span>
                            </button>
                            <button id="reset-success" class="control-btn warning">
                                <i class="fas fa-undo"></i>
                                <span>Reset Success State</span>
                            </button>
                            <button id="export-data" class="control-btn info">
                                <i class="fas fa-download"></i>
                                <span>Export Analytics</span>
                            </button>
                            <button id="view-logs" class="control-btn secondary">
                                <i class="fas fa-file-alt"></i>
                                <span>View Latest Logs</span>
                            </button>
                        </div>
                        <div class="control-info">
                            <p><i class="fas fa-info-circle"></i> Manual controls require GitHub authentication via personal access token.</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="dashboard-footer">
            <div class="footer-content">
                <p>&copy; 2024 Oracle Instance Creator Dashboard - Enhanced Analytics v2.0</p>
                <div class="footer-links">
                    <a href="https://github.com/senomorf/OracleInstanceCreator" target="_blank">
                        <i class="fab fa-github"></i> Repository
                    </a>
                    <a href="#" id="about-link">
                        <i class="fas fa-question-circle"></i> About
                    </a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Modal for Settings -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Dashboard Settings</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <form id="settings-form">
                    <div class="form-group">
                        <label for="github-token">GitHub Personal Access Token:</label>
                        <input type="password" id="github-token" placeholder="ghp_xxxxxxxxxxxx">
                        <small>Required for workflow controls and private repository access</small>
                    </div>
                    <div class="form-group">
                        <label for="repo-owner">Repository Owner:</label>
                        <input type="text" id="repo-owner" placeholder="username">
                    </div>
                    <div class="form-group">
                        <label for="repo-name">Repository Name:</label>
                        <input type="text" id="repo-name" placeholder="OracleInstanceCreator">
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="auto-refresh"> Auto-refresh data every 30 seconds
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="save-settings" class="btn primary">Save Settings</button>
                <button type="button" class="btn secondary" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Settings Button -->
    <button id="settings-btn" class="floating-btn" title="Settings">
        <i class="fas fa-cog"></i>
    </button>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <script src="js/dashboard.js"></script>
</body>
</html>